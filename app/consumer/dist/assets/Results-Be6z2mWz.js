var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(s,a,n)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[a]=n,t=(e,s)=>{for(var a in s||(s={}))r.call(s,a)&&i(e,a,s[a]);if(n)for(var a of n(s))l.call(s,a)&&i(e,a,s[a]);return e},c=(e,n)=>s(e,a(n)),o=(e,s,a)=>new Promise((n,r)=>{var l=e=>{try{t(a.next(e))}catch(s){r(s)}},i=e=>{try{t(a.throw(e))}catch(s){r(s)}},t=e=>e.done?n(e.value):Promise.resolve(e.value).then(l,i);t((a=a.apply(e,s)).next())});import{j as d}from"./index-Dr5LwVtT.js";import{L as m,r as _,u,e as h}from"./react-vendor-DQcjAbTS.js";import{g as p}from"./trust-score-BT4cMY15.js";import{u as x}from"./useAllergenProfile-DznOho4c.js";import{V as g,u as f}from"./useScanHistory-C_Jdk5j4.js";import{u as j}from"./useReducedMotion--ddu61Lm.js";const N="_banner_ht4vq_5",v="_iconContainer_ht4vq_77",y="_icon_ht4vq_77",b="_content_ht4vq_111",w="_title_ht4vq_125",S="_message_ht4vq_141",k="_allergenList_ht4vq_155",C="_why_ht4vq_173",T="_editLink_ht4vq_187";function $({detectedAllergens:e}){return 0===e.length?null:d.jsxs("div",{className:N,role:"alert","aria-live":"assertive",children:[d.jsx("div",{className:v,children:d.jsx("span",{className:y,"aria-hidden":"true",children:"âš ï¸"})}),d.jsxs("div",{className:b,children:[d.jsx("h3",{className:w,children:"Allergen Alert"}),d.jsxs("p",{className:S,children:["This product contains allergens from your profile:"," ",d.jsx("strong",{className:k,children:e.join(", ")})]}),d.jsx("p",{className:C,children:"Based on your allergen profile. Always verify labels directly."})]}),d.jsx(m,{to:"/settings",className:T,children:"Edit profile â†’"})]})}const I={container:"_container_1huew_5",title:"_title_1huew_17",groupsContainer:"_groupsContainer_1huew_39",group:"_group_1huew_39",groupHeader:"_groupHeader_1huew_79",groupIcon:"_groupIcon_1huew_125",groupInfo:"_groupInfo_1huew_149",groupLabel:"_groupLabel_1huew_163",groupDescription:"_groupDescription_1huew_175",groupCount:"_groupCount_1huew_185",groupToggle:"_groupToggle_1huew_215",list:"_list_1huew_243",item:"_item_1huew_261",danger:"_danger_1huew_323",warn:"_warn_1huew_357",ok:"_ok_1huew_391",header:"_header_1huew_419",icon:"_icon_1huew_433",labelContainer:"_labelContainer_1huew_491",label:"_label_1huew_491",severityBadge:"_severityBadge_1huew_527","severity-low":"_severity-low_1huew_549","severity-medium":"_severity-medium_1huew_561","severity-high":"_severity-high_1huew_573",explanation:"_explanation_1huew_585",matchedText:"_matchedText_1huew_601",matchedTextLabel:"_matchedTextLabel_1huew_617",matchedTextContent:"_matchedTextContent_1huew_637",source:"_source_1huew_663",empty:"_empty_1huew_733",emptyIcon:"_emptyIcon_1huew_781",bounce:"_bounce_1huew_1",emptyText:"_emptyText_1huew_809",userAllergen:"_userAllergen_1huew_825",allergenPulse:"_allergenPulse_1huew_1",allergenBadge:"_allergenBadge_1huew_867"},D={banned_claims:{label:"Banned Claims",icon:"ðŸš«",description:"Claims that violate policy regulations"},allergens:{label:"Allergens",icon:"âš ï¸",description:"Allergen-related warnings"},missing_disclaimers:{label:"Missing Disclaimers",icon:"ðŸ“‹",description:"Required disclaimers not found"},weasel_words:{label:"Weasel Words",icon:"ðŸ”",description:"Vague or misleading language detected"},recall_signals:{label:"Recall Signals",icon:"ðŸ””",description:"Potential recall indicators"},other:{label:"Other Issues",icon:"ðŸ“Œ",description:"Additional findings"}};function L({issues:e,userAllergens:s=[]}){const[a,n]=_.useState(new Set(["banned_claims","allergens","missing_disclaimers","weasel_words","recall_signals"]));if(0===e.length)return d.jsxs("div",{className:I.empty,children:[d.jsx("span",{className:I.emptyIcon,children:"âœ“"}),d.jsx("p",{className:I.emptyText,children:"No issues detected"})]});const r=e=>{if(0===s.length)return!1;const a=e.label.toLowerCase(),n=e.explanation.toLowerCase();return s.some(e=>a.includes(e.toLowerCase())||n.includes(e.toLowerCase()))},l=e.reduce((e,s)=>{const a=(e=>{if(e.category)return e.category;const s=e.label.toLowerCase(),a=e.explanation.toLowerCase();return s.includes("allergen")||a.includes("allergen")||s.includes("contains")||r(e)?"allergens":s.includes("banned")||s.includes("prohibited")||s.includes("claim")||a.includes("policy violation")?"banned_claims":s.includes("disclaimer")||s.includes("missing")||a.includes("required statement")?"missing_disclaimers":s.includes("weasel")||s.includes("vague")||a.includes("misleading language")?"weasel_words":s.includes("recall")||a.includes("recall")?"recall_signals":"other"})(s);return e[a].push(s),e},{banned_claims:[],allergens:[],missing_disclaimers:[],weasel_words:[],recall_signals:[],other:[]}),i=Object.keys(l).filter(e=>l[e].length>0),t=e.filter(e=>r(e)||e.isUserAllergen).flatMap(e=>s.filter(s=>e.label.toLowerCase().includes(s.toLowerCase())||e.explanation.toLowerCase().includes(s.toLowerCase()))).filter((e,s,a)=>a.indexOf(e)===s);return d.jsxs("div",{className:I.container,children:[d.jsx("h2",{className:I.title,children:"Detected Issues"}),t.length>0&&d.jsx($,{detectedAllergens:t}),d.jsx("div",{className:I.groupsContainer,children:i.map(e=>{const s=D[e],i=l[e],t=a.has(e),c=i.length;return d.jsxs("div",{className:I.group,children:[d.jsxs("button",{className:I.groupHeader,onClick:()=>(e=>{n(s=>{const a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a})})(e),"aria-expanded":t,"aria-controls":`group-${e}`,children:[d.jsx("span",{className:I.groupIcon,children:s.icon}),d.jsxs("div",{className:I.groupInfo,children:[d.jsx("span",{className:I.groupLabel,children:s.label}),d.jsx("span",{className:I.groupDescription,children:s.description})]}),d.jsx("span",{className:I.groupCount,children:c}),d.jsx("span",{className:I.groupToggle,"aria-hidden":"true",children:t?"â–¼":"â–¶"})]}),t&&d.jsx("ul",{id:`group-${e}`,className:I.list,role:"list",children:i.map((e,s)=>((e,s)=>{const a=e.isUserAllergen||r(e),n=e.severity||("danger"===e.kind?"high":"warn"===e.kind?"medium":"low");return d.jsxs("li",{className:`${I.item} ${I[e.kind]} ${a?I.userAllergen:""}`,children:[d.jsxs("div",{className:I.header,children:[d.jsx("span",{className:I.icon,"aria-hidden":"true",children:"danger"===e.kind?"âœ•":"warn"===e.kind?"âš ":"âœ“"}),d.jsxs("div",{className:I.labelContainer,children:[d.jsxs("span",{className:I.label,children:[e.label,a&&d.jsx("span",{className:I.allergenBadge,"aria-label":"From your allergen profile",children:"ðŸ›¡ï¸"})]}),d.jsx("span",{className:`${I.severityBadge} ${I[`severity-${n}`]}`,children:n})]})]}),d.jsx("p",{className:I.explanation,children:e.explanation}),e.matchedText&&d.jsxs("div",{className:I.matchedText,children:[d.jsx("span",{className:I.matchedTextLabel,children:"Matched text:"}),d.jsx("code",{className:I.matchedTextContent,children:e.matchedText})]}),e.source&&d.jsx("a",{href:e.source,className:I.source,target:"_blank",rel:"noopener noreferrer",children:"View source â†’"})]},s)})(e,s))})]},e)})})]})}const A="_container_7d1ay_5",B="_trigger_7d1ay_13",R="_arrow_7d1ay_67",E="_arrowOpen_7d1ay_79",F="_content_7d1ay_87",P="_breakdownList_7d1ay_119",O="_breakdownItem_7d1ay_131",U="_breakdownLabel_7d1ay_165",W="_breakdownValue_7d1ay_177",q="_positive_7d1ay_191",M="_negative_7d1ay_199",V="_total_7d1ay_207";function G({breakdown:e}){const[s,a]=_.useState(!1),n=()=>{a(!s)};return d.jsxs("div",{className:A,children:[d.jsxs("button",{className:B,onClick:n,onKeyDown:e=>{"Enter"===e.key||" "===e.key?(e.preventDefault(),n()):"Escape"===e.key&&s&&a(!1)},"aria-expanded":s,"aria-controls":"score-breakdown",children:[d.jsx("span",{children:"Why this score?"}),d.jsx("span",{className:`${R} ${s?E:""}`,"aria-hidden":"true",children:"â–¼"})]}),s&&d.jsx("div",{id:"score-breakdown",className:F,role:"region","aria-label":"Score breakdown",children:d.jsxs("div",{className:P,children:[d.jsxs("div",{className:O,children:[d.jsx("span",{className:U,children:"Base Score"}),d.jsxs("span",{className:W,children:["+",e.baseScore]})]}),e.bannedClaimsDeduction>0&&d.jsxs("div",{className:O,children:[d.jsx("span",{className:U,children:"Banned Claims"}),d.jsxs("span",{className:`${W} ${M}`,children:["-",e.bannedClaimsDeduction]})]}),e.recallDeduction>0&&d.jsxs("div",{className:O,children:[d.jsx("span",{className:U,children:"Product Recall"}),d.jsxs("span",{className:`${W} ${M}`,children:["-",e.recallDeduction]})]}),e.allergenDeduction>0&&d.jsxs("div",{className:O,children:[d.jsx("span",{className:U,children:"Allergen Concerns"}),d.jsxs("span",{className:`${W} ${M}`,children:["-",e.allergenDeduction]})]}),e.weaselWordDeduction>0&&d.jsxs("div",{className:O,children:[d.jsx("span",{className:U,children:"Vague Claims"}),d.jsxs("span",{className:`${W} ${M}`,children:["-",e.weaselWordDeduction]})]}),e.cleanBonus>0&&d.jsxs("div",{className:O,children:[d.jsx("span",{className:U,children:"Clean Bonus"}),d.jsxs("span",{className:`${W} ${q}`,children:["+",e.cleanBonus]})]}),d.jsxs("div",{className:`${O} ${V}`,children:[d.jsx("span",{className:U,children:"Final Score"}),d.jsx("span",{className:W,children:e.finalScore})]})]})})]})}const H=[{id:"prod_001",name:"Organic Whole Wheat Bread",trustScore:95,verdict:"allow",keyDifferences:["No preservatives","Organic ingredients","Whole grain"],thumbnail:void 0},{id:"prod_002",name:"Natural Almond Butter",trustScore:98,verdict:"allow",keyDifferences:["100% almonds","No added sugar","No palm oil"],thumbnail:void 0},{id:"prod_003",name:"Greek Yogurt Plain",trustScore:92,verdict:"allow",keyDifferences:["High protein","No artificial sweeteners","Live cultures"],thumbnail:void 0},{id:"prod_004",name:"Organic Oat Milk",trustScore:88,verdict:"allow",keyDifferences:["Plant-based","Fortified with vitamins","No added sugar"],thumbnail:void 0},{id:"prod_005",name:"Whole Grain Crackers",trustScore:85,verdict:"allow",keyDifferences:["Whole grains","Low sodium","No artificial flavors"],thumbnail:void 0},{id:"prod_006",name:"Dark Chocolate 70%",trustScore:82,verdict:"allow",keyDifferences:["High cocoa content","Low sugar","Antioxidants"],thumbnail:void 0},{id:"prod_007",name:"Quinoa Pasta",trustScore:90,verdict:"allow",keyDifferences:["Gluten-free","High protein","Complete amino acids"],thumbnail:void 0},{id:"prod_008",name:"Coconut Water Natural",trustScore:87,verdict:"allow",keyDifferences:["No added sugar","Natural electrolytes","Low calorie"],thumbnail:void 0}];const J="_container_11mmi_11",z="_header_11mmi_61",K="_title_11mmi_71",Q="_description_11mmi_109",Y="_noSuggestions_11mmi_123",X="_noSuggestionsIcon_11mmi_139",Z="_noSuggestionsText_11mmi_163",ee="_personalization_11mmi_181",se="_personalizationTitle_11mmi_197",ae="_toggles_11mmi_215",ne="_toggle_11mmi_215",re="_toggleInput_11mmi_263",le="_toggleLabel_11mmi_339",ie="_toggleBadge_11mmi_355",te="_list_11mmi_387",ce="_suggestion_11mmi_399",oe="_thumbnail_11mmi_471",de="_thumbnailImage_11mmi_489",me="_content_11mmi_511",_e="_name_11mmi_535",ue="_score_11mmi_553",he="_scoreLabel_11mmi_579",pe="_scoreValue_11mmi_593",xe="_scoreDiff_11mmi_607",ge="_scoreExplanation_11mmi_645",fe="_scoreExplanationLabel_11mmi_665",je="_scoreExplanationText_11mmi_681",Ne="_differences_11mmi_697",ve="_differencesLabel_11mmi_709",ye="_differencesList_11mmi_725",be="_differenceItem_11mmi_743",we="_viewButton_11mmi_799",Se="_disclaimer_11mmi_859",ke="_disclaimerIcon_11mmi_883",Ce="_disclaimerText_11mmi_895";function Te({currentScore:e,category:s}){const a=u(),{getAllAllergens:n}=x(),[r,l]=_.useState({respectAllergens:!0,vegetarian:!1,vegan:!1,noAddedSugar:!1}),i=function(e){return e>=80?[]:H.filter(s=>s.trustScore>=e+20).sort((e,s)=>s.trustScore-e.trustScore).slice(0,3)}(e),o=e=>{!function(e){try{const s="claimlens_suggestion_clicks",a=localStorage.getItem(s),n=a?JSON.parse(a):{};n[e]=(n[e]||0)+1,localStorage.setItem(s,JSON.stringify(n))}catch(s){}}(e.id);const s={trust_score:e.trustScore,verdict:p(e.trustScore),badges:[],reasons:[]},n=btoa(JSON.stringify(s));a(`/results?data=${n}`)};return 0===i.length?d.jsxs("div",{className:J,children:[d.jsx("h2",{className:K,children:"Safer Swaps"}),d.jsxs("div",{className:Y,children:[d.jsx("div",{className:X,children:"âœ¨"}),d.jsx("p",{className:Z,children:"Great choice! This product already has a high trust score. No alternatives needed."})]})]}):d.jsxs("div",{className:J,children:[d.jsxs("div",{className:z,children:[d.jsx("h2",{className:K,children:"Safer Swaps"}),d.jsx("p",{className:Q,children:"Consider these alternatives with better trust scores"})]}),d.jsxs("div",{className:ee,children:[d.jsx("h3",{className:se,children:"Personalize suggestions"}),d.jsxs("div",{className:ae,children:[d.jsxs("label",{className:ne,children:[d.jsx("input",{type:"checkbox",checked:r.respectAllergens,onChange:e=>l(s=>c(t({},s),{respectAllergens:e.target.checked})),className:re}),d.jsxs("span",{className:le,children:["Respect my allergens",r.respectAllergens&&n().length>0&&d.jsx("span",{className:ie,children:n().length})]})]}),d.jsxs("label",{className:ne,children:[d.jsx("input",{type:"checkbox",checked:r.vegetarian,onChange:e=>l(s=>c(t({},s),{vegetarian:e.target.checked,vegan:!e.target.checked&&s.vegan})),className:re}),d.jsx("span",{className:le,children:"Vegetarian"})]}),d.jsxs("label",{className:ne,children:[d.jsx("input",{type:"checkbox",checked:r.vegan,onChange:e=>l(s=>c(t({},s),{vegan:e.target.checked,vegetarian:!e.target.checked&&s.vegetarian})),className:re}),d.jsx("span",{className:le,children:"Vegan"})]}),d.jsxs("label",{className:ne,children:[d.jsx("input",{type:"checkbox",checked:r.noAddedSugar,onChange:e=>l(s=>c(t({},s),{noAddedSugar:e.target.checked})),className:re}),d.jsx("span",{className:le,children:"No added sugar"})]})]})]}),d.jsx("div",{className:te,children:i.map(s=>{const a=p(s.trustScore),n=s.trustScore-e;return d.jsxs("div",{className:ce,children:[s.thumbnail&&d.jsx("div",{className:oe,children:d.jsx("img",{src:s.thumbnail,alt:"",className:de})}),d.jsxs("div",{className:me,children:[d.jsxs("div",{className:z,children:[d.jsx("h3",{className:_e,children:s.name}),d.jsx(g,{verdict:a,compact:!0})]}),d.jsxs("div",{className:ue,children:[d.jsx("span",{className:he,children:"Trust Score:"}),d.jsx("span",{className:pe,children:s.trustScore}),d.jsxs("span",{className:xe,children:["(+",n," points)"]})]}),d.jsxs("div",{className:ge,children:[d.jsx("span",{className:fe,children:"What changed the score:"}),d.jsx("p",{className:je,children:n>=30?"Significantly fewer policy violations and cleaner ingredient list":n>=20?"Fewer flagged claims and better compliance":"Minor improvements in policy compliance"})]}),d.jsxs("div",{className:Ne,children:[d.jsx("span",{className:ve,children:"Key differences:"}),d.jsx("ul",{className:ye,children:s.keyDifferences.map((e,s)=>d.jsx("li",{className:be,children:e},s))})]}),d.jsx("button",{className:we,onClick:()=>o(s),"aria-label":`View details for ${s.name}`,children:"View Details"})]})]},s.id)})}),d.jsxs("div",{className:Se,children:[d.jsx("span",{className:ke,children:"âš ï¸"}),d.jsx("span",{className:Ce,children:"Suggestions may not match all preferencesâ€¦ Always check labels."})]})]})}const $e="_container_mtr26_1",Ie="_trigger_mtr26_9",De="_triggerIcon_mtr26_61",Le="_triggerText_mtr26_71",Ae="_triggerSubtext_mtr26_83",Be="_triggerArrow_mtr26_97",Re="_content_mtr26_109",Ee="_header_mtr26_149",Fe="_title_mtr26_157",Pe="_subtitle_mtr26_171",Oe="_meta_mtr26_183",Ue="_metaItem_mtr26_203",We="_metaLabel_mtr26_215",qe="_metaValue_mtr26_231",Me="_empty_mtr26_245",Ve="_emptySubtext_mtr26_257",Ge="_receipts_mtr26_269",He="_receipt_mtr26_269",Je="_receiptHeader_mtr26_311",ze="_receiptTitle_mtr26_329",Ke="_receiptBadge_mtr26_341",Qe="_receiptMeta_mtr26_361",Ye="_receiptMetaItem_mtr26_379",Xe="_diff_mtr26_389",Ze="_diffSection_mtr26_407",es="_diffLabel_mtr26_419",ss="_diffCode_mtr26_435",as=_.memo(function({receipts:e=[],correlationId:s,checksRun:a=0}){const[n,r]=_.useState(!1);return _.useEffect(()=>{const e=e=>{"Escape"===e.key&&n&&r(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n]),d.jsxs("div",{className:$e,children:[d.jsxs("button",{className:Ie,onClick:()=>r(!n),"aria-expanded":n,"aria-controls":"receipts-content",children:[d.jsx("span",{className:De,children:"ðŸ“‹"}),d.jsx("span",{className:Le,children:"Receipts"}),d.jsx("span",{className:Ae,children:"No tricks. Just proof."}),d.jsx("span",{className:Be,"aria-hidden":"true",children:n?"â–¼":"â–¶"})]}),n&&d.jsxs("div",{id:"receipts-content",className:Re,children:[d.jsxs("div",{className:Ee,children:[d.jsx("h3",{className:Fe,children:"Why this verdict?"}),d.jsx("p",{className:Pe,children:"Transparent evidence for every decision"})]}),s&&d.jsxs("div",{className:Oe,children:[d.jsxs("div",{className:Ue,children:[d.jsx("span",{className:We,children:"Request ID:"}),d.jsx("code",{className:qe,children:s})]}),d.jsxs("div",{className:Ue,children:[d.jsx("span",{className:We,children:"Checks run:"}),d.jsx("span",{className:qe,children:a})]})]}),0===e.length?d.jsxs("div",{className:Me,children:[d.jsx("p",{children:"No policy violations detected"}),d.jsx("p",{className:Ve,children:"All checks passed successfully"})]}):d.jsx("div",{className:Ge,children:e.map((e,s)=>d.jsxs("div",{className:He,children:[d.jsxs("div",{className:Je,children:[d.jsx("div",{className:ze,children:e.ruleName}),d.jsxs("div",{className:Ke,children:[e.packName," v",e.packVersion]})]}),d.jsxs("div",{className:Qe,children:[d.jsxs("span",{className:Ye,children:[d.jsx("strong",{children:"Rule ID:"})," ",e.ruleId]}),d.jsxs("span",{className:Ye,children:[d.jsx("strong",{children:"Transform:"})," ",e.transformStep]}),d.jsxs("span",{className:Ye,children:[d.jsx("strong",{children:"Time:"})," ",new Date(e.timestamp).toLocaleTimeString()]})]}),(e.beforeSnippet||e.afterSnippet)&&d.jsxs("div",{className:Xe,children:[e.beforeSnippet&&d.jsxs("div",{className:Ze,children:[d.jsx("div",{className:es,children:"Before:"}),d.jsx("code",{className:ss,children:e.beforeSnippet})]}),e.afterSnippet&&d.jsxs("div",{className:Ze,children:[d.jsx("div",{className:es,children:"After:"}),d.jsx("code",{className:ss,children:e.afterSnippet})]})]})]},s))})]})]})}),ns={banner:"_banner_csswu_11",allow:"_allow_csswu_45",modify:"_modify_csswu_55",avoid:"_avoid_csswu_71",header:"_header_csswu_137",badge:"_badge_csswu_151",icon:"_icon_csswu_187",label:"_label_csswu_203",content:"_content_csswu_215",microcopy:"_microcopy_csswu_229",reason:"_reason_csswu_251",calmGlow:"_calmGlow_csswu_1",emberPulse:"_emberPulse_csswu_1",dangerHalo:"_dangerHalo_csswu_1"},rs={allow:"Marked safeâ€¦ for now.",modify:"Proceed with caution.",avoid:"Do not invite this into your body."},ls={allow:"âœ“",modify:"âš ",avoid:"âœ•"},is={allow:"#10B981",modify:"#F59E0B",avoid:"#EF4444"},ts=_.memo(function({verdict:e,score:s,reason:a}){const n=rs[e],r=ls[e],l=is[e];return d.jsxs("div",{className:`${ns.banner} ${ns[e]}`,role:"status","aria-label":`Verdict: ${e}, Trust Score: ${s}`,children:[d.jsx("div",{className:ns.header,children:d.jsxs("div",{className:ns.badge,style:{backgroundColor:`${l}20`,borderColor:l,color:l},children:[d.jsx("span",{className:ns.icon,"aria-hidden":"true",children:r}),d.jsx("span",{className:ns.label,children:e.charAt(0).toUpperCase()+e.slice(1)})]})}),d.jsxs("div",{className:ns.content,children:[d.jsx("p",{className:ns.microcopy,children:n}),a&&d.jsx("p",{className:ns.reason,children:a})]})]})}),cs="_container_1nku1_11",os="_scoreSection_1nku1_25",ds="_label_1nku1_39",ms="_score_1nku1_25",_s="_maxScore_1nku1_77",us="_breakdownSection_1nku1_91",hs="_breakdownToggle_1nku1_105",ps="_breakdown_1nku1_91",xs="_breakdownItem_1nku1_181",gs="_breakdownLabel_1nku1_205",fs="_breakdownValue_1nku1_217",js="_deduction_1nku1_231",Ns="_bonus_1nku1_239",vs="_total_1nku1_247",ys=_.memo(function({score:e,breakdown:s}){const a=Math.max(0,Math.min(100,e)),[n,r]=_.useState(!1),[l,i]=_.useState(0),t=j(),c=_.useRef();return _.useEffect(()=>{if(t)return void i(a);const e=Date.now(),s=a,n=()=>{const a=Date.now()-e,r=Math.min(a/800,1),l=1-Math.pow(1-r,2),t=Math.round(0+(s-0)*l);i(t),r<1&&(c.current=requestAnimationFrame(n))};return c.current=requestAnimationFrame(n),()=>{c.current&&cancelAnimationFrame(c.current)}},[a,t]),d.jsxs("div",{className:cs,children:[d.jsxs("div",{className:os,children:[d.jsx("div",{className:ds,children:"Trust Score"}),d.jsx("div",{className:ms,role:"status","aria-label":`Trust score: ${a} out of 100`,children:l}),d.jsx("div",{className:_s,children:"/ 100"})]}),s&&d.jsxs("div",{className:us,children:[d.jsxs("button",{className:hs,onClick:()=>r(!n),"aria-expanded":n,"aria-controls":"score-breakdown",children:[n?"â–¼":"â–¶"," Score Breakdown"]}),n&&d.jsxs("div",{id:"score-breakdown",className:ps,role:"region","aria-label":"Trust score breakdown details",children:[d.jsxs("div",{className:xs,children:[d.jsx("span",{className:gs,children:"Base Score"}),d.jsxs("span",{className:fs,children:["+",s.baseScore]})]}),s.bannedClaimsDeduction>0&&d.jsxs("div",{className:xs,children:[d.jsx("span",{className:gs,children:"Banned Claims"}),d.jsxs("span",{className:`${fs} ${js}`,children:["-",s.bannedClaimsDeduction]})]}),s.recallDeduction>0&&d.jsxs("div",{className:xs,children:[d.jsx("span",{className:gs,children:"Recall Signals"}),d.jsxs("span",{className:`${fs} ${js}`,children:["-",s.recallDeduction]})]}),s.allergenDeduction>0&&d.jsxs("div",{className:xs,children:[d.jsx("span",{className:gs,children:"User Allergens"}),d.jsxs("span",{className:`${fs} ${js}`,children:["-",s.allergenDeduction]})]}),s.weaselWordDeduction>0&&d.jsxs("div",{className:xs,children:[d.jsx("span",{className:gs,children:"Weasel Words"}),d.jsxs("span",{className:`${fs} ${js}`,children:["-",s.weaselWordDeduction]})]}),s.cleanBonus>0&&d.jsxs("div",{className:xs,children:[d.jsx("span",{className:gs,children:"Clean Bonus"}),d.jsxs("span",{className:`${fs} ${Ns}`,children:["+",s.cleanBonus]})]}),d.jsxs("div",{className:`${xs} ${vs}`,children:[d.jsx("span",{className:gs,children:"Final Score"}),d.jsx("span",{className:fs,children:s.finalScore})]})]})]})]})}),bs="_canvas_1c58k_5",ws={allow:"Marked safeâ€¦ for now.",modify:"Proceed with caution.",avoid:"Do not invite this into your body."},Ss={allow:"#10B981",modify:"#F59E0B",avoid:"#EF4444"},ks=_.memo(function({verdict:e,score:s,topReasons:a,receiptsUrl:n,productName:r,onGenerated:l}){const i=_.useRef(null),[t,c]=_.useState("");return _.useEffect(()=>{if(!n)return;(()=>{o(this,null,function*(){try{const e=document.createElement("canvas");e.width=120,e.height=120;const s=e.getContext("2d");s&&(s.fillStyle="#FFFFFF",s.fillRect(0,0,120,120),s.fillStyle="#000000",s.font="10px monospace",s.fillText("QR Code",30,60),s.fillText("Placeholder",20,75),c(e.toDataURL()))}catch(e){}})})()},[n]),_.useEffect(()=>{const n=i.current;if(!n)return;const c=n.getContext("2d");if(!c)return;n.width=600,n.height=400,c.fillStyle="#0B1220",c.fillRect(0,0,n.width,n.height);const o=c.createLinearGradient(0,0,0,n.height);if(o.addColorStop(0,"rgba(20, 184, 166, 0.05)"),o.addColorStop(1,"rgba(139, 92, 246, 0.05)"),c.fillStyle=o,c.fillRect(0,0,n.width,n.height),c.fillStyle="#F8FAFC",c.font="bold 24px system-ui, -apple-system, sans-serif",c.fillText("ClaimLens",40,50),c.fillStyle="#94A3B8",c.font="14px system-ui, -apple-system, sans-serif",c.fillText("Proof-first food claim verification",40,75),r){c.fillStyle="#E2E8F0",c.font="16px system-ui, -apple-system, sans-serif";const e=r.length>40?r.substring(0,37)+"...":r;c.fillText(e,40,110)}const d=Ss[e],m=e.charAt(0).toUpperCase()+e.slice(1);c.fillStyle=d+"40",c.fillRect(40,130,200,60),c.strokeStyle=d,c.lineWidth=2,c.strokeRect(40,130,200,60),c.fillStyle=d,c.font="bold 20px system-ui, -apple-system, sans-serif",c.fillText(m,60,165),c.fillStyle="#F8FAFC",c.font="bold 48px system-ui, -apple-system, sans-serif",c.fillText(s.toString(),280,175),c.fillStyle="#94A3B8",c.font="20px system-ui, -apple-system, sans-serif",c.fillText("/ 100",350,175),c.fillStyle="#CBD5E1",c.font="italic 14px system-ui, -apple-system, sans-serif";const _=ws[e];c.fillText(_,40,220),c.fillStyle="#F8FAFC",c.font="bold 16px system-ui, -apple-system, sans-serif",c.fillText("Key Findings:",40,260),c.fillStyle="#E2E8F0",c.font="14px system-ui, -apple-system, sans-serif";if(a.slice(0,2).forEach((e,s)=>{const a=285+25*s,n=e.length>50?e.substring(0,47)+"...":e;c.fillText(`â€¢ ${n}`,50,a)}),t){const e=new Image;e.onload=()=>{c.drawImage(e,460,240,100,100),c.fillStyle="#94A3B8",c.font="11px system-ui, -apple-system, sans-serif",c.fillText("Scan for",475,355),c.fillText("full receipts",465,370),l&&l(n.toDataURL("image/png"))},e.src=t}else l&&l(n.toDataURL("image/png"));c.fillStyle="#64748B",c.font="12px system-ui, -apple-system, sans-serif",c.fillText("No tricks. Just proof.",40,370)},[e,s,a,t,r,l]),d.jsx("canvas",{ref:i,className:bs,"aria-label":"Proof card image"})}),Cs="_container_1hcxc_11",Ts="_header_1hcxc_57",$s="_nameSection_1hcxc_71",Is="_productName_1hcxc_81",Ds="_unknown_1hcxc_99",Ls="_metadata_1hcxc_109",As="_brand_1hcxc_127",Bs="_separator_1hcxc_137",Rs="_category_1hcxc_145",Es="_actions_1hcxc_153",Fs="_sourceChip_1hcxc_167",Ps="_sourceIcon_1hcxc_205",Os="_sourceLabel_1hcxc_215",Us="_renameButton_1hcxc_223",Ws=_.memo(function({productIdentity:e,onRename:s}){const{name:a,brand:n,category:r,sourceType:l,sourceLabel:i}=e,t=!a||"Unknown Item"===a;return d.jsx("div",{className:Cs,children:d.jsxs("div",{className:Ts,children:[d.jsxs("div",{className:$s,children:[d.jsx("h1",{className:`${Is} ${t?Ds:""}`,children:a||"Unknown Item"}),(n||r)&&d.jsxs("div",{className:Ls,children:[n&&d.jsx("span",{className:As,children:n}),n&&r&&d.jsx("span",{className:Bs,children:"â€¢"}),r&&d.jsx("span",{className:Rs,children:r})]})]}),d.jsxs("div",{className:Es,children:[d.jsxs("div",{className:Fs,children:[d.jsx("span",{className:Ps,"aria-hidden":"true",children:(e=>{switch(e){case"url":return"ðŸŒ";case"screenshot":return"ðŸ“¸";case"barcode":return"ðŸ“Š";case"text":return"ðŸ“";default:return"ðŸ”"}})(l)}),d.jsx("span",{className:Os,children:(()=>{if(i)return i;switch(l){case"url":return"Web URL";case"screenshot":return"Screenshot";case"barcode":return"Barcode Scan";case"text":return"Text Input";default:return"Scan"}})()})]}),s&&d.jsx("button",{className:Us,onClick:()=>{if(!s)return;const e=prompt("Enter product name:",a||"");e&&e.trim()&&e!==a&&s(e.trim())},"aria-label":"Rename product",title:"Rename product",children:"âœï¸ Rename"})]})]})})});function qs(e){return o(this,null,function*(){if(navigator.share)try{if(e.imageDataUrl){const s=yield function(e){return o(this,null,function*(){return(yield fetch(e)).blob()})}(e.imageDataUrl),a=new File([s],"claimlens-proof.png",{type:"image/png"});if(navigator.canShare&&navigator.canShare({files:[a]}))return yield navigator.share({title:e.title,text:e.text,files:[a]}),{success:!0,method:"native"}}return yield navigator.share({title:e.title,text:e.text,url:e.url}),{success:!0,method:"native"}}catch(s){if(s instanceof Error&&"AbortError"===s.name)return{success:!1,method:"failed",error:"Share cancelled"}}try{return yield function(e){return o(this,null,function*(){if(navigator.clipboard&&navigator.clipboard.writeText)yield navigator.clipboard.writeText(e);else{const s=document.createElement("textarea");s.value=e,s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select();try{if(!document.execCommand("copy"))throw new Error("Copy command failed")}finally{document.body.removeChild(s)}}})}(e.url),{success:!0,method:"clipboard"}}catch(s){return{success:!1,method:"failed",error:s instanceof Error?s.message:"Failed to copy to clipboard"}}})}function Ms(e){const s=JSON.stringify(e);return btoa(encodeURIComponent(s))}const Vs="_container_1a3ge_5",Gs="_loading_1a3ge_107",Hs="_empty_1a3ge_179",Js="_emptyTitle_1a3ge_193",zs="_emptyText_1a3ge_213",Ks="_dashboardGrid_1a3ge_435",Qs="_heroScoreCard_1a3ge_457",Ys="_scoreLayout_1a3ge_519",Xs="_gaugeContainer_1a3ge_535",Zs="_quickStats_1a3ge_689",ea="_statItem_1a3ge_703",sa="_statValue_1a3ge_733",aa="_statLabel_1a3ge_749",na="_verdictSection_1a3ge_769",ra="_allergenNote_1a3ge_845",la="_allergenNoteIcon_1a3ge_869",ia="_allergenNoteText_1a3ge_877",ta="_editProfileLink_1a3ge_887",ca="_allergenWarning_1a3ge_915",oa="_warningIcon_1a3ge_953",da="_warningContent_1a3ge_967",ma="_warningTitle_1a3ge_975",_a="_warningText_1a3ge_989",ua="_issuesCard_1a3ge_1017",ha="_breakdownCard_1a3ge_1041",pa="_cardTitle_1a3ge_1063",xa="_cardIcon_1a3ge_1083",ga="_actions_1a3ge_1095",fa="_button_1a3ge_1115",ja="_buttonSecondary_1a3ge_1205",Na="_historyToggle_1a3ge_1235",va="_toggleLabel_1a3ge_1257",ya="_toggleInput_1a3ge_1273",ba="_toggleSlider_1a3ge_1287",wa="_toggleText_1a3ge_1363",Sa="_shareStatus_1a3ge_1377";function ka(){var e;const[s]=h(),a=u(),{getAllAllergens:n}=x(),{addScan:r}=f(),[l,i]=_.useState(null),[t,c]=_.useState(!0),[g,j]=_.useState(!0),[N,v]=_.useState(!1),[y,b]=_.useState(!1),[w,S]=_.useState(""),[k,C]=_.useState("");_.useEffect(()=>{const e=s.get("data");if(e)try{const s=decodeURIComponent(atob(e)),a=JSON.parse(s);i(a),c(!1),j(!1)}catch(a){c(!1)}else{const e=sessionStorage.getItem("scanResults");if(e)try{const s=JSON.parse(e);i(s),c(!1)}catch(a){c(!1)}else c(!1)}},[s]),_.useEffect(()=>{var e;if(l&&g&&!N)try{const s=JSON.stringify(l),a=btoa(encodeURIComponent(s)),n=(null==(e=l.productIdentity)?void 0:e.name)||"Unknown Item";r({productName:n,trustScore:l.trust_score,verdict:l.verdict.label,resultData:a,productIdentity:l.productIdentity}),v(!0)}catch(s){}},[l,g,N,r]);const T=()=>{sessionStorage.removeItem("scanResults"),a("/scan")};if(t)return d.jsx("div",{className:Vs,children:d.jsx("div",{className:Gs})});if(!l)return d.jsx("div",{className:Vs,children:d.jsxs("div",{className:Hs,children:[d.jsx("h1",{className:Js,children:"No Results Found"}),d.jsx("p",{className:zs,children:"No scan results found. Please scan a product first."}),d.jsx("button",{className:fa,onClick:T,children:"ðŸ” Start Scanning"})]})});const $=p(l.trust_score),I=n(),D=I.length>0,A="caution"===$.label?"modify":$.label,B=[...l.badges,...l.reasons.map(e=>({kind:"warn",label:e.transform,explanation:e.why,source:e.source}))],R=B.filter(e=>"danger"===e.kind||"warn"===e.kind).slice(0,2).map(e=>e.explanation||e.label),E=l.correlation_id?`${window.location.origin}/results?data=${Ms(l)}#receipts`:void 0,F=l.user_allergens_detected||[],P=D&&F.length>0,O=B.filter(e=>"danger"===e.kind||"warn"===e.kind).length,U=B.filter(e=>"ok"===e.kind).length,W=B.length;return d.jsx("div",{className:Vs,children:d.jsxs("div",{className:Ks,children:[d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsx(Ws,{productIdentity:l.productIdentity})}),d.jsx("div",{className:Qs,children:d.jsxs("div",{className:Ys,children:[d.jsxs("div",{className:Xs,children:[d.jsx(ys,{score:l.trust_score,breakdown:l.breakdown}),d.jsxs("div",{className:Zs,children:[d.jsxs("div",{className:ea,children:[d.jsx("span",{className:sa,children:O}),d.jsx("span",{className:aa,children:"Issues"})]}),d.jsxs("div",{className:ea,children:[d.jsx("span",{className:sa,children:U}),d.jsx("span",{className:aa,children:"Clean"})]}),d.jsxs("div",{className:ea,children:[d.jsx("span",{className:sa,children:W}),d.jsx("span",{className:aa,children:"Checks"})]})]})]}),d.jsxs("div",{className:na,children:[d.jsx(ts,{verdict:A,score:l.trust_score,reason:0===O?"No policy violations found in the checks we ran. Based on claim policy + allergen profile + disclaimers rules.":$.explanation}),D&&d.jsxs("div",{className:ra,children:[d.jsx("span",{className:la,children:"ðŸ›¡ï¸"}),d.jsx("span",{className:ia,children:"Based on your allergen profile"}),d.jsx(m,{to:"/settings",className:ta,children:"Edit profile â†’"})]})]})]})}),P&&d.jsxs("div",{className:ca,children:[d.jsx("div",{className:oa,children:"âš ï¸"}),d.jsxs("div",{className:da,children:[d.jsx("h3",{className:ma,children:"Allergen Alert"}),d.jsxs("p",{className:_a,children:["This product contains allergens from your profile:"," ",d.jsx("strong",{children:F.join(", ")})]})]})]}),d.jsxs("div",{className:ua,children:[d.jsxs("h3",{className:pa,children:[d.jsx("span",{className:xa,children:"ðŸ”"}),"Detected Issues"]}),d.jsx(L,{issues:B,userAllergens:I})]}),l.breakdown&&d.jsxs("div",{className:ha,children:[d.jsxs("h3",{className:pa,children:[d.jsx("span",{className:xa,children:"ðŸ“Š"}),"Score Breakdown"]}),d.jsx(G,{breakdown:l.breakdown})]}),d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsx(Te,{currentScore:l.trust_score})}),d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsx(as,{correlationId:l.correlation_id,checksRun:W})}),y&&d.jsx("div",{style:{position:"absolute",left:"-9999px"},children:d.jsx(ks,{verdict:A,score:l.trust_score,topReasons:R,receiptsUrl:E,productName:null==(e=l.product_info)?void 0:e.product_name,onGenerated:S})}),d.jsxs("div",{className:ga,children:[d.jsx("button",{className:fa,onClick:T,children:"ðŸ” Scan Another Product"}),d.jsx("button",{className:`${fa} ${ja}`,onClick:()=>o(this,null,function*(){if(!l)return;C("Generating proof card..."),b(!0),yield new Promise(e=>setTimeout(e,500));const e=Ms(l),s=(a=e,`${window.location.origin}/results?data=${encodeURIComponent(a)}`);var a;const n=yield qs({title:"ClaimLens Scan Results",text:`Trust Score: ${l.trust_score} - ${$.label}`,url:s,imageDataUrl:w||void 0});n.success?"native"===n.method?C("âœ“ Shared successfully!"):"clipboard"===n.method&&C("âœ“ Link copied to clipboard!"):C("âœ— Share failed. Try again."),setTimeout(()=>C(""),3e3)}),disabled:!!k&&k.includes("Generating"),children:"ðŸ“¤ Share Results"}),w&&d.jsx("button",{className:`${fa} ${ja}`,onClick:()=>{var e;if(w){const s=`claimlens-${((null==(e=null==l?void 0:l.product_info)?void 0:e.product_name)||"scan").replace(/\s+/g,"-").toLowerCase()}.png`;!function(e,s="claimlens-proof.png"){const a=document.createElement("a");a.href=e,a.download=s,document.body.appendChild(a),a.click(),document.body.removeChild(a)}(w,s),C("âœ“ Proof card downloaded!"),setTimeout(()=>C(""),3e3)}},children:"ðŸ’¾ Download Proof Card"})]}),k&&d.jsx("div",{className:Sa,children:k}),d.jsx("div",{className:Na,children:d.jsxs("label",{className:va,children:[d.jsx("input",{type:"checkbox",checked:g,onChange:e=>j(e.target.checked),className:ya,"aria-label":"Save scan to history"}),d.jsx("span",{className:ba}),d.jsx("span",{className:wa,children:N?"âœ“ Saved to history":"ðŸ’¾ Save to history"})]})})]})})}export{ka as default};
